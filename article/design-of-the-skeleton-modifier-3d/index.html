<!doctype html><html lang=en><meta charset=utf-8><script type=module>
		// This code sample uses features introduced in Workbox v6.
		import {Workbox} from "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-window.prod.mjs";

		if ("serviceWorker" in navigator) {
		  const wb = new Workbox("/godot-website/sw.js");
		  let registration;

		  const showSkipWaitingPrompt = async (event) => {
			// Assuming the user accepted the update, set up a listener
			// that will reload the page as soon as the previously waiting
			// service worker has taken control.
			wb.addEventListener("controlling", () => {
			  // At this point, reloading will ensure that the current
			  // tab is loaded under the control of the new service worker.
			  // Depending on your web app, you may want to auto-save or
			  // persist transient state before triggering the reload.
			  window.location.reload();
			});

			// When `event.wasWaitingBeforeRegister` is true, a previously
			// updated service worker is still waiting.
			// You may want to customize the UI prompt accordingly.

			// This code assumes your app has a promptForUpdate() method,
			// which returns true if the user wants to update.
			// Implementing this is app-specific; some examples are:
			// https://open-ui.org/components/alert.research or
			// https://open-ui.org/components/toast.research
			// const updateAccepted = await promptForUpdate();

			// if (updateAccepted) {
			  wb.messageSkipWaiting();
			// }
		  };

		  // Add an event listener to detect when the registered
		  // service worker has installed but is waiting to activate.
		  wb.addEventListener("waiting", (event) => {
			showSkipWaitingPrompt(event);
		  });

		  wb.register();
		}
	  </script><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Godot Engine"><meta name=description content="We have reworked the skeleton bone update process to add SkeletonModifier3D for modifying the Skeleton."><meta name=theme-color content="#3d8fcc"><meta property="og:site_name" content="Godot Engine"><meta property="og:url" content="https://godotengine.org/article/design-of-the-skeleton-modifier-3d/"><meta name=twitter:site content="@godotengine"><meta property="og:title" content="Design of the Skeleton Modifier 3D"><meta property="og:description" content="We have reworked the skeleton bone update process to add SkeletonModifier3D for modifying the Skeleton."><meta name=image property="og:image" content="https://godotengine.org/storage/blog/covers/design-of-the-skeleton-modifier-3d.webp"><meta property="og:type" content="article"><meta name=twitter:card content="summary_large_image"><title>Design of the Skeleton Modifier 3D</title><link rel=alternate type=application/rss+xml title="Godot News" href=/rss.xml><link rel=icon href=/assets/favicon.png sizes=any><link rel=icon href=/assets/favicon.svg type=image/svg+xml><link rel=stylesheet href=/assets/css/main.css?113><link rel=stylesheet href=/assets/css/tobii.min.css><link rel=preload as=font href=/assets/fonts/Montserrat-Italic-VariableFont_wght.woff2 crossorigin><link rel=preload as=font href=/assets/fonts/Montserrat-VariableFont_wght.woff2 crossorigin><link rel=me href=https://mastodon.gamedev.place/@godotengine><style>.report-bugs-and-content-missing{background-color:#ffffe0;position:relative;padding:10px;margin:0;top:0;left:0}</style><div class=report-bugs-and-content-missing><div class=report-bugs-and-content-missing-content><h4>This is a private preview for the <a href=/godot-website/releases/4.3/>4.3 release page</a></h4><p>Please report bugs and content missing on the <a href=https://github.com/godotengine/godot-website/pull/882>PR for the release page</a>.<p><small>If there's no style, please reload the page, as a service worker is needed to redirect calls to the <code>/godot-website</code> directory.</small></div></div><input type=checkbox id=nav_toggle_cb><header><div class="container flex align-center"><div id=nav_head><a href=/ id=logo-link><img class=nav-logo src=/assets/logo.svg width=136 height=48 alt="Godot Engine">
<img class="nav-logo dark-logo" src=/assets/logo_dark.svg width=136 height=48 alt="Godot Engine"></a>
<label for=nav_toggle_cb id=nav_toggle_btn><img src=/assets/icons/hamburger.svg width=24 height=24 alt="Main menu"></label></div><nav id=nav><ul class=left><li><a href=/features/>Features</a><li class=only-on-mobile><a href=/showcase/>Showcase</a><li><a href=/blog/>Blog</a><li><a href=/community/>Community</a><li><a href=/contact/>About</a><li><a href=https://godotengine.org/asset-library/asset>Assets</a></ul><ul class=right><li><a href=/download/windows/ class=set-os-download-url>Download</a><li><a href=https://docs.godotengine.org>Docs</a><li><a href=https://docs.godotengine.org/en/stable/contributing/how_to_contribute.html>Contribute</a><li class=fund><a href=https://fund.godotengine.org>❤&#xFE0E; Donate</a></ul></nav></div></header><main><style>body{background-color:var(--background-color)}h1{margin-bottom:8px;margin-top:32px}:not(pre)>code{background:var(--code-background-color);padding:1px 4px;font-size:.95em;border-radius:3px}pre{background:var(--codeblock-background-color);color:var(--codeblock-color)}pre code{display:block;overflow-x:auto;padding:.5em}.date-big{line-height:2;margin-left:32px}article{background-color:var(--base-color);box-shadow:0 3px 2px rgba(0,0,0,.15)}figure{margin:0}figure img{margin:0}article img,article video{max-width:100%;height:auto;display:block;margin:auto;margin-top:16px;margin-bottom:16px}article h1{margin-top:64px}article h2,article h3,article h4{margin-top:42px}.article-info{display:flex;flex-direction:column;gap:8px}.article-metadata{display:flex;gap:24px;align-items:center;font-family:var(--header-font-family);margin-bottom:12px}@media(max-width:900px){.article-metadata{flex-direction:column;align-items:flex-start;gap:16px}}.article-author{color:var(--base-color-text-subtitle-date);font-weight:700;font-size:18px;flex-grow:1;display:flex;gap:12px;align-items:center}.article-author .avatar{border-radius:100%;margin:0}.article-author .by{color:var(--base-color-text-subtitle)}.article-metadata .date{color:var(--base-color-text-subtitle-date)}.article-metadata .date.post-recent-highlight{color:var(--post-recent-highlight-color);opacity:.8}.article-metadata .date.post-recent-highlight::after{font-size:80%;content:"NEW";border:2px solid var(--post-recent-highlight-color);padding:2px 3px;margin-left:8px}.tag.active{filter:saturate(.75)}@media screen and (min-width:900px){article .content{width:70%;margin:auto}}@media(max-width:900px){body{background-color:var(--base-color)}article{background-color:initial;box-shadow:none}article img:first-child,article video:first-child{max-width:100%}}</style><link rel=stylesheet href=/assets/css/highlight.obsidian.min.css><div class=container><article class=padded><div class="content article-container"><figure class=article-cover><img src=/storage/blog/covers/design-of-the-skeleton-modifier-3d.webp title alt=" " class=rounded-lg style=width:100%;height:auto;background-color:initial></figure><div class=article-info><h1>Design of the Skeleton Modifier 3D</h1><div class=article-metadata><div class=article-author><span>By:</span>
<img class=avatar width=25 height=25 src=/assets/images/authors/tokage.png alt="Silc Renew" loading=lazy>
<span class=by>Silc Renew</span></div><span class=date data-post-date="2024-08-12 10:00:00 +0000">12 August 2024</span></div><div class=tags><a href=/blog/progress-report><div class="tag active">Progress Report</div></a></div></div><div class=article-body><style>article .content img{background-color:initial}</style><p>In Godot 4.3 we are adding a new node called <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code>. It is used to animate <code class="language-plaintext highlighter-rouge">Skeleton3D</code>s outside of <code class="language-plaintext highlighter-rouge">AnimationMixer</code> and is now the base class for several existing nodes.<p>As part of this we have deprecated (but not removed) some of the pose override functionality in <code class="language-plaintext highlighter-rouge">Skeleton3D</code> including:<ul><li><code class="language-plaintext highlighter-rouge">set_bone_global_pose_override()</code><li><code class="language-plaintext highlighter-rouge">get_bone_global_pose_override()</code><li><code class="language-plaintext highlighter-rouge">get_bone_global_pose_no_override()</code><li><code class="language-plaintext highlighter-rouge">clear_bones_global_pose_override()</code></ul><h1 id=did-the-pose-override-design-have-problems>Did the pose override design have problems?</h1><p><img src=/storage/blog/design-of-the-skeleton-modifier-3d/mod.webp alt=modification><p>Previously, we recommended using the property <code class="language-plaintext highlighter-rouge">global_pose_override</code> when modifying the bones. This was useful because the original pose was kept separately, so blend values could be set, and bones could be modified without changing the property in <code class="language-plaintext highlighter-rouge">.tscn</code> file. However, the more complex people’s demands for Godot 3D became, the less it covered the use cases and became outdated.<p>The main problem is the fact that “the processing order between <code class="language-plaintext highlighter-rouge">Skeleton3D</code> and <code class="language-plaintext highlighter-rouge">AnimationMixer</code> is changed depending on the <code class="language-plaintext highlighter-rouge">SceneTree</code> structure`.<p><strong>For example, it means that the following two scenes will have different results:</strong><p><img src=/storage/blog/design-of-the-skeleton-modifier-3d/different_process_orders.webp alt="different process orders"><p>If there is a modifier such as IK or physical bone, in most cases, it needs to be applied to the result of the played animation. So they need to be processed after the <code class="language-plaintext highlighter-rouge">AnimationMixer</code>.<p>In the old skeleton modifier design with bone pose override you must place those modifiers below the <code class="language-plaintext highlighter-rouge">AnimationMixer</code>. However as scene trees become more complex, it becomes difficult to keep track of the processing order. Also the scene might be imported from glTF which cannot be edited without localization, so managing node order becomes tedious.<p>Moreover, if multiple nodes use bone pose override, it breaks the modified result.<p><strong>Let’s imagine a case in which bone modification is performed in the following order:</strong><div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>AnimationMixer -&gt; ModifierA -&gt; ModifierB
</code></pre></div></div><p>Keep in mind that both <code class="language-plaintext highlighter-rouge">ModifierA</code> and <code class="language-plaintext highlighter-rouge">ModifierB</code> need to get the bone pose that was processed immediately before.<p>The <code class="language-plaintext highlighter-rouge">AnimationMixer</code> does not use <code class="language-plaintext highlighter-rouge">set_bone_global_pose_override()</code>, so it transforms the original pose as <code class="language-plaintext highlighter-rouge">set_bone_pose_rotation()</code>. This means that the input to <code class="language-plaintext highlighter-rouge">ModifierA</code> must be retrieved from the original pose with <code class="language-plaintext highlighter-rouge">get_bone_global_pose_no_override()</code> and the output must be retreived from the override with <code class="language-plaintext highlighter-rouge">get_bone_global_pose_override()</code>. In this case, if <code class="language-plaintext highlighter-rouge">ModiferB</code> wants to consider the output of <code class="language-plaintext highlighter-rouge">ModiferA</code>, both the input and output of <code class="language-plaintext highlighter-rouge">ModifierB</code> must be the override with <code class="language-plaintext highlighter-rouge">get_bone_global_pose_override()</code>.<p>Then, can the order of <code class="language-plaintext highlighter-rouge">ModifierA</code> and <code class="language-plaintext highlighter-rouge">ModifierB</code> be interchanged?<p>–The answer is “NO”.<p>Because <code class="language-plaintext highlighter-rouge">ModifierB</code>’s input is now <code class="language-plaintext highlighter-rouge">get_bone_global_pose_override()</code> which is different from <code class="language-plaintext highlighter-rouge">get_bone_global_pose_no_override()</code>, so <code class="language-plaintext highlighter-rouge">ModifierB</code> cannot get the original pose set by the <code class="language-plaintext highlighter-rouge">AnimationMixer</code>.<p>As I described above, the override design was very weak in terms of process ordering.<h1 id=how-does-the-new-skeleton-design-work-with-skeletonmodifier3d>How does the new skeleton design work with SkeletonModifier3D?</h1><p><code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> is designed to modify bones in the <code class="language-plaintext highlighter-rouge">_process_modification()</code> virtual method. This means that if you want to develop a custom <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code>, you will need to modify the bones within that method.<p><code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> does not execute modifications by itself, but is executed by the parent of <code class="language-plaintext highlighter-rouge">Skeleton3D</code>. By placing <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> as a child of <code class="language-plaintext highlighter-rouge">Skeleton3D</code>, they are registered in <code class="language-plaintext highlighter-rouge">Skeleton3D</code>, and the process is executed only once per frame in the <code class="language-plaintext highlighter-rouge">Skeleton3D</code> update process. Then, <strong>the processing order between modifiers is guaranteed to be the same as the order of the children in <code class="language-plaintext highlighter-rouge">Skeleton3D</code>’s child list</strong>.<p>Since <code class="language-plaintext highlighter-rouge">AnimationMixer</code> is applied before the <code class="language-plaintext highlighter-rouge">Skeleton3D</code> update process, <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> is guaranteed to run after <code class="language-plaintext highlighter-rouge">AnimationMixer</code>. Also, they do not require <code class="language-plaintext highlighter-rouge">bone_pose_global_override</code>; This removes any confusion as to whether we should use override or not.<p><strong>Here is a SkeletonModifier3D sequence diagram:</strong><p><img src=/storage/blog/design-of-the-skeleton-modifier-3d/skeleton_modifier_process.webp alt="skeleton modifier process"><p>Dirty flag resolution may be performed several times per frame, but the update process is a deferred call and is performed only once per frame.<p>At the beginning of the update process, it stores the pose before the modification process temporarily. When the modification process is complete and applied to the skin, the pose is rolled back to the temporarily stored pose. This performs the role of the past <code class="language-plaintext highlighter-rouge">bone_pose_global_override</code> which stored the override pose separate from the original pose.<p>By the way, you may want to get the pose after the modification, or you may wonder why the modifier in the later part cannot enter the original pose when there are multiple modifiers.<p>We have added some signals for cases where you need to retrieve the pose at each point in time, so you can use them.<ul><li>AnimationMixer: mixer_applied<ul><li>Notifies when the blending result related have been applied to the target objects</ul><li>SkeletonModifier3D: modification_processed<ul><li>Notifies when the modification have been finished</ul><li>Skeleton3D: skeleton_updated<ul><li>Emitted when the final pose has been calculated will be applied to the skin in the update process</ul></ul><p>Also, note that this process depends on the <code class="language-plaintext highlighter-rouge">Skeleton3D.modifier_callback_mode_process</code> property.<p><img src=/storage/blog/design-of-the-skeleton-modifier-3d/modifier_callback_mode_process.webp alt="modifier callback mode process property"><p>For example, in a use case that the node uses the physics process outside of <code class="language-plaintext highlighter-rouge">Skeleton3D</code> and it affects <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code>, the property must be set to <code class="language-plaintext highlighter-rouge">Physics</code>.<p>Finally, now we can say that <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> does not make it impossible to do anything that was possible in the past.<h1 id=how-to-make-a-custom-skeletonmodifier3d>How to make a custom SkeletonModifier3D?</h1><p><code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> is a virtual class, so you can’t add it as stand alone node to a scene.<p><img src=/storage/blog/design-of-the-skeleton-modifier-3d/add_skeleton_modifier.webp alt="add skeleton modifier"><p>Then, how do we create a custom <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code>? Let’s try to create a simple custom <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> that points the Y-axis of a bone to a specific coordinate.<h2 id=1-create-a-script>1. Create a script</h2><p>Create a blank gdscript file that extends <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code>. At this time, register the custom <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> you created with the <code class="language-plaintext highlighter-rouge">class_name</code> declaration so that it can be added to the scene dock.<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>class_name</span> <span class=n>CustomModifier</span>
<span class=k>extends</span> <span class=n>SkeletonModifier3D</span>
</code></pre></div></div><p><img src=/storage/blog/design-of-the-skeleton-modifier-3d/register_custom_modifier.webp alt="register custom modifier"><h2 id=2-add-some-declarations-and-properties>2. Add some declarations and properties</h2><p>If necessary, add a property to set the bone by declaring <code class="language-plaintext highlighter-rouge">@export_enum</code> and set the <code class="language-plaintext highlighter-rouge">Skeleton3D</code> bone names as a hint in <code class="language-plaintext highlighter-rouge">_validate_property()</code>. You also need to declare <code class="language-plaintext highlighter-rouge">@tool</code> if you want to select it in the editor.<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=err>@</span><span class=k>tool</span>

<span class=k>class_name</span> <span class=n>CustomModifier</span>
<span class=k>extends</span> <span class=n>SkeletonModifier3D</span>

<span class=err>@</span><span class=k>export</span> <span class=k>var</span> <span class=n>target_coordinate</span><span class=p>:</span> <span class=kt>Vector3</span> <span class=o>=</span> <span class=kt>Vector3</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
<span class=err>@</span><span class=n>export_enum</span><span class=p>(</span><span class=s2>" "</span><span class=p>)</span> <span class=k>var</span> <span class=n>bone</span><span class=p>:</span> <span class=kt>String</span>

<span class=k>func</span> <span class=nf>_validate_property</span><span class=p>(</span><span class=n>property</span><span class=p>:</span> <span class=kt>Dictionary</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>void</span><span class=p>:</span>
	<span class=k>if</span> <span class=n>property</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>"bone"</span><span class=p>:</span>
		<span class=k>var</span> <span class=n>skeleton</span><span class=p>:</span> <span class=n>Skeleton3D</span> <span class=o>=</span> <span class=n>get_skeleton</span><span class=p>()</span>
		<span class=k>if</span> <span class=n>skeleton</span><span class=p>:</span>
			<span class=n>property</span><span class=o>.</span><span class=n>hint</span> <span class=o>=</span> <span class=n>PROPERTY_HINT_ENUM</span>
			<span class=n>property</span><span class=o>.</span><span class=n>hint_string</span> <span class=o>=</span> <span class=n>skeleton</span><span class=o>.</span><span class=n>get_concatenated_bone_names</span><span class=p>()</span>
</code></pre></div></div><p>The <code class="language-plaintext highlighter-rouge">@tool</code> declaration is also required for previewing modifications by <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code>, so you can consider it is required basically.<p><img src=/storage/blog/design-of-the-skeleton-modifier-3d/bones_enum.webp alt="bones enum"><h2 id=3-coding-calculations-of-the-modification-in-_process_modification>3. Coding calculations of the modification in <code class="language-plaintext highlighter-rouge">_process_modification()</code></h2><div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=err>@</span><span class=k>tool</span>

<span class=k>class_name</span> <span class=n>CustomModifier</span>
<span class=k>extends</span> <span class=n>SkeletonModifier3D</span>

<span class=err>@</span><span class=k>export</span> <span class=k>var</span> <span class=n>target_coordinate</span><span class=p>:</span> <span class=kt>Vector3</span> <span class=o>=</span> <span class=kt>Vector3</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
<span class=err>@</span><span class=n>export_enum</span><span class=p>(</span><span class=s2>" "</span><span class=p>)</span> <span class=k>var</span> <span class=n>bone</span><span class=p>:</span> <span class=kt>String</span>

<span class=k>func</span> <span class=nf>_validate_property</span><span class=p>(</span><span class=n>property</span><span class=p>:</span> <span class=kt>Dictionary</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>void</span><span class=p>:</span>
	<span class=k>if</span> <span class=n>property</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>"bone"</span><span class=p>:</span>
		<span class=k>var</span> <span class=n>skeleton</span><span class=p>:</span> <span class=n>Skeleton3D</span> <span class=o>=</span> <span class=n>get_skeleton</span><span class=p>()</span>
		<span class=k>if</span> <span class=n>skeleton</span><span class=p>:</span>
			<span class=n>property</span><span class=o>.</span><span class=n>hint</span> <span class=o>=</span> <span class=n>PROPERTY_HINT_ENUM</span>
			<span class=n>property</span><span class=o>.</span><span class=n>hint_string</span> <span class=o>=</span> <span class=n>skeleton</span><span class=o>.</span><span class=n>get_concatenated_bone_names</span><span class=p>()</span>

<span class=k>func</span> <span class=nf>_process_modification</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>void</span><span class=p>:</span>
	<span class=k>var</span> <span class=n>skeleton</span><span class=p>:</span> <span class=n>Skeleton3D</span> <span class=o>=</span> <span class=n>get_skeleton</span><span class=p>()</span>
	<span class=k>if</span> <span class=o>!</span><span class=n>skeleton</span><span class=p>:</span>
		<span class=k>return</span> <span class=c1># Never happen, but for the safety.</span>
	<span class=k>var</span> <span class=n>bone_idx</span><span class=p>:</span> <span class=kt>int</span> <span class=o>=</span> <span class=n>skeleton</span><span class=o>.</span><span class=n>find_bone</span><span class=p>(</span><span class=n>bone</span><span class=p>)</span>
	<span class=k>var</span> <span class=n>parent_idx</span><span class=p>:</span> <span class=kt>int</span> <span class=o>=</span> <span class=n>skeleton</span><span class=o>.</span><span class=n>get_bone_parent</span><span class=p>(</span><span class=n>bone_idx</span><span class=p>)</span>
	<span class=k>var</span> <span class=n>pose</span><span class=p>:</span> <span class=n>Transform3D</span> <span class=o>=</span> <span class=n>skeleton</span><span class=o>.</span><span class=n>global_transform</span> <span class=o>*</span> <span class=n>skeleton</span><span class=o>.</span><span class=n>get_bone_global_pose</span><span class=p>(</span><span class=n>bone_idx</span><span class=p>)</span>
	<span class=k>var</span> <span class=n>looked_at</span><span class=p>:</span> <span class=n>Transform3D</span> <span class=o>=</span> <span class=n>_y_look_at</span><span class=p>(</span><span class=n>pose</span><span class=p>,</span> <span class=n>target_coordinate</span><span class=p>)</span>
	<span class=n>skeleton</span><span class=o>.</span><span class=n>set_bone_global_pose</span><span class=p>(</span><span class=n>bone_idx</span><span class=p>,</span> <span class=n>Transform3D</span><span class=p>(</span><span class=n>looked_at</span><span class=o>.</span><span class=n>basis</span><span class=o>.</span><span class=n>orthonormalized</span><span class=p>(),</span> <span class=n>skeleton</span><span class=o>.</span><span class=n>get_bone_global_pose</span><span class=p>(</span><span class=n>bone_idx</span><span class=p>)</span><span class=o>.</span><span class=n>origin</span><span class=p>))</span>

<span class=k>func</span> <span class=nf>_y_look_at</span><span class=p>(</span><span class=n>from</span><span class=p>:</span> <span class=n>Transform3D</span><span class=p>,</span> <span class=n>target</span><span class=p>:</span> <span class=kt>Vector3</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Transform3D</span><span class=p>:</span>
	<span class=k>var</span> <span class=n>t_v</span><span class=p>:</span> <span class=kt>Vector3</span> <span class=o>=</span> <span class=n>target</span> <span class=o>-</span> <span class=n>from</span><span class=o>.</span><span class=n>origin</span>
	<span class=k>var</span> <span class=n>v_y</span><span class=p>:</span> <span class=kt>Vector3</span> <span class=o>=</span> <span class=n>t_v</span><span class=o>.</span><span class=n>normalized</span><span class=p>()</span>
	<span class=k>var</span> <span class=n>v_z</span><span class=p>:</span> <span class=kt>Vector3</span> <span class=o>=</span> <span class=n>from</span><span class=o>.</span><span class=n>basis</span><span class=o>.</span><span class=n>x</span><span class=o>.</span><span class=n>cross</span><span class=p>(</span><span class=n>v_y</span><span class=p>)</span>
	<span class=n>v_z</span> <span class=o>=</span> <span class=n>v_z</span><span class=o>.</span><span class=n>normalized</span><span class=p>()</span>
	<span class=k>var</span> <span class=n>v_x</span><span class=p>:</span> <span class=kt>Vector3</span> <span class=o>=</span> <span class=n>v_y</span><span class=o>.</span><span class=n>cross</span><span class=p>(</span><span class=n>v_z</span><span class=p>)</span>
	<span class=n>from</span><span class=o>.</span><span class=n>basis</span> <span class=o>=</span> <span class=kt>Basis</span><span class=p>(</span><span class=n>v_x</span><span class=p>,</span> <span class=n>v_y</span><span class=p>,</span> <span class=n>v_z</span><span class=p>)</span>
	<span class=k>return</span> <span class=n>from</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">_process_modification()</code> is a virtual method called in the update process after the AnimationMixer has been applied, as described in the sequence diagram above. If you modify bones in it, it is guaranteed that the order in which the modifications are applied will match the order of <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> of the <code class="language-plaintext highlighter-rouge">Skeleton3D</code>’s child list.</p><video autoplay loop muted playsinline>
<source src=/storage/blog/design-of-the-skeleton-modifier-3d/custom_modifier.webm?1 type=video/webm></video><p>Note that the modification should always be applied to the bones at 100% amount. Because <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> has an <code class="language-plaintext highlighter-rouge">influence</code> property, the value of which is processed and interpolated by <code class="language-plaintext highlighter-rouge">Skeleton3D</code>. In other words, you do not need to write code to change the amount of modification applied; You should avoid implementing duplicate interpolation processes. However, if your custom <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> can specify multiple bones and you want to manage the amount separately for each bone, it makes sense that adding the amount properties for each bone to your custom modifier.<p>Finally, remember that this method will not be called if the parent is not a <code class="language-plaintext highlighter-rouge">Skeleton3D</code>.<h2 id=4-retrieve-modified-values-from-other-nodes>4. Retrieve modified values from other Nodes</h2><p>The modification by <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> is immediately discarded after it is applied to the skin, so it is not reflected in the bone pose of <code class="language-plaintext highlighter-rouge">Skeleton3D</code> during <code class="language-plaintext highlighter-rouge">_process()</code>.<p>If you need to retrieve the modificated pose values from other nodes, you must connect them to the appropriate signals.<p>For example, this is a <code class="language-plaintext highlighter-rouge">Label3D</code> which reflects the modification after the animation is applied and after all modifications are processed.<div class="language-gdscript highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=err>@</span><span class=k>tool</span>

<span class=k>extends</span> <span class=n>Label3D</span>

<span class=err>@</span><span class=k>onready</span> <span class=k>var</span> <span class=n>poses</span><span class=p>:</span> <span class=kt>Dictionary</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>"animated_pose"</span><span class=p>:</span> <span class=s2>""</span><span class=p>,</span> <span class=s2>"modified_pose"</span><span class=p>:</span> <span class=s2>""</span> <span class=p>}</span>

<span class=k>func</span> <span class=nf>_update_text</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>void</span><span class=p>:</span>
	<span class=n>text</span> <span class=o>=</span> <span class=s2>"animated_pose:"</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>poses</span><span class=p>[</span><span class=s2>"animated_pose"</span><span class=p>])</span> <span class=o>+</span> <span class=s2>"</span><span class=se>\n</span><span class=s2>"</span> <span class=o>+</span> <span class=s2>"modified_pose:"</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>poses</span><span class=p>[</span><span class=s2>"modified_pose"</span><span class=p>])</span>

<span class=k>func</span> <span class=nf>_on_animation_player_mixer_applied</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>void</span><span class=p>:</span>
	<span class=n>poses</span><span class=p>[</span><span class=s2>"animated_pose"</span><span class=p>]</span> <span class=o>=</span> <span class=o>$</span><span class=s2>"../Armature/Skeleton3D"</span><span class=o>.</span><span class=n>get_bone_pose</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
	<span class=n>_update_text</span><span class=p>()</span>

<span class=k>func</span> <span class=nf>_on_skeleton_3d_skeleton_updated</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>void</span><span class=p>:</span>
	<span class=n>poses</span><span class=p>[</span><span class=s2>"modified_pose"</span><span class=p>]</span> <span class=o>=</span> <span class=o>$</span><span class=s2>"../Armature/Skeleton3D"</span><span class=o>.</span><span class=n>get_bone_pose</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
	<span class=n>_update_text</span><span class=p>()</span>
</code></pre></div></div><p>You can see the pose is different depending on the signal.<p><img src=/storage/blog/design-of-the-skeleton-modifier-3d/modified_pose.webp alt="modified pose"><h3 id=download>Download</h3><p><a href=/storage/blog/design-of-the-skeleton-modifier-3d/skeleton-modifier-3d-demo-project.zip>skeleton-modifier-3d-demo-project.zip</a><h1 id=do-i-always-need-to-create-a-custom-skeletonmodifier3d-when-modifying-a-skeleton3d-bone>Do I always need to create a custom SkeletonModifier3D when modifying a Skeleton3D bone?</h1><p>As explained above, the modification provided by <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> is temporary. So <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> would be appropriate for effectors and controllers as <strong>post FX</strong>.<p>If you want permanent modifications, i.e., if you want to develop something like a bone editor, then it makes sense that it is not a <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code>. Also, in simple cases where it is guaranteed that no other <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> will be used in the scene, your judgment will prevail.<h1 id=what-kind-of-skeletonmodifier3d-nodes-are-included-in-godot-43>What kind of SkeletonModifier3D nodes are included in Godot 4.3?</h1><p>For now, Godot 4.3 will be containing only <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code> which is a migration of several existing nodes that have been in existence since 4.0.<p>But, there is good news! We are planning to add some built in <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code>s in Godot 4.4, such as new IK, constraint, and springbone/jiggle.<p>If you are interested in developing your own effect using <code class="language-plaintext highlighter-rouge">SkeletonModifier3D</code>, feel free to make a proposal to include it in core.<h2 id=support>Support</h2><p>Godot is a non-profit, open source game engine developed by hundreds of contributors on their free time, as well as a handful of part or full-time developers hired thanks to <a href=https://fund.godotengine.org/>generous donations from the Godot community</a>. A big thank you to everyone who has contributed <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md>their time</a> or <a href=https://github.com/godotengine/godot/blob/master/DONORS.md>their financial support</a> to the project!<p>If you’d like to support the project financially and help us secure our future hires, you can do so using the <a href=https://fund.godotengine.org/>Godot Development Fund</a> platform managed by <a href=https://godot.foundation/>Godot Foundation</a>. There are also several <a href=/donate>alternative ways to donate</a> which you may find more suitable.</div></div></article></div><link rel=stylesheet href=/assets/css/anchor-link.css?1><link rel=stylesheet href=/assets/css/article-cards.css?2><script src=/assets/js/anchor-link.js></script>
<script>document.addEventListener('DOMContentLoaded',()=>{window.applyAnchorLinks('.article-body'),document.querySelectorAll('.article-cover img, .article-body img').forEach(b=>{if(b.classList.contains('lightbox-ignore'))return;const a=document.createElement('a');a.href=b.src,a.classList.add('lightbox'),a.dataset.group='article',b.parentNode.appendChild(a),a.appendChild(b)})})</script></main><footer><div class="container flex footer-container"><div id=copyright><p>© 2007-2024 Juan Linietsky, Ariel Manzur and <a href=https://github.com/godotengine/godot/blob/master/AUTHORS.md target=_blank rel=noopener>contributors</a>.<br>Hosted by the <a href=https://godot.foundation/ target=_blank rel=noopener>Godot Foundation</a>.<br>Website <a href=https://github.com/godotengine/godot-website target=_blank rel=noopener>source code on GitHub</a>.</div><div id=sitemap><ul class=sitemap-group><li><strong>Get Godot</strong><li><a href=/download/windows/ class=set-os-download-url>Download</a><li><a href=/download/archive/>Release Archive</a><li><a href=https://editor.godotengine.org/releases/latest/>Web Editor</a><li>&nbsp;<li><strong>Public Relations</strong><li><a href=/blog/>Blog</a><li><a href=/community/>Communities and Events</a><li><a href=/press/>Press Kit</a></ul><ul class=sitemap-group><li><strong>About Godot</strong><li><a href=/features/>Features</a><li><a href=/showcase/>Showcase</a><li><a href=/education/>Education</a><li><a href=/license/>License</a><li><a href=/code-of-conduct/>Code of Conduct</a><li><a href=/privacy-policy/>Privacy Policy</a><li><a href=https://fund.godotengine.org>Donate</a></ul><ul class=sitemap-group><li><strong>Project Team</strong><li><a href=/governance/>Governance</a><li><a href=/teams/>Teams</a><li>&nbsp;<li><strong>Extra Resources</strong><li><a href=https://godotengine.org/asset-library/asset>Asset Library</a><li><a href=https://docs.godotengine.org>Documentation</a><li><a href=https://github.com/godotengine>Code Repository</a></ul></div><div id=social class=dark-desaturate><h4 class=text-right><a href=/contact/>Contact us</a></h4><div class="flex justify-space-between" style=gap:3px><a href=https://github.com/godotengine target=_blank rel=noopener><img src=/assets/footer/github_logo.svg width=32 height=32 alt=GitHub></a>
<a href=https://mastodon.gamedev.place/@godotengine target=_blank rel=noopener><img src=/assets/footer/mastodon_logo.svg width=32 height=32 alt=Mastodon></a>
<a href=https://twitter.com/godotengine target=_blank rel=noopener><img src=/assets/footer/twitter_logo.svg width=32 height=32 alt=Twitter></a>
<a href=https://www.facebook.com/groups/godotengine/ target=_blank rel=noopener><img src=/assets/footer/facebook_logo.svg width=32 height=32 alt=Facebook></a>
<a href=https://www.reddit.com/r/godot target=_blank rel=noopener><img src=/assets/footer/reddit_logo.svg width=32 height=32 alt=Red​dit></a>
<a href=/rss.xml target=_blank rel=noopener><img src=/assets/footer/feed_logo.svg width=32 height=32 alt="RSS feed"></a></div></div></div></footer><script defer src=/assets/js/tobii.min.js></script>
<script defer src=/assets/js/highlight.min.js?1></script>
<script defer src=/assets/js/highlight.gdscript.min.js?1></script>
<script>document.addEventListener('DOMContentLoaded',()=>{document.querySelectorAll('pre code').forEach(a=>{hljs.highlightBlock(a)}),document.querySelectorAll('[data-post-date]').forEach(a=>{Date.parse(a.dataset.postDate)>Date.now()-1e3*60*60*48&&a.classList.add("post-recent-highlight")}),new Tobii({zoom:!1});const a=document.querySelectorAll('.set-os-download-url');for(let b=0;b<a.length;b++){const c=a[b];let e='download';'version'in c.dataset&&c.dataset.version==='3'&&(e='download/3.x');let d='windows';navigator.platform.indexOf('Mac')!==-1?d='macos':navigator.platform.indexOf('Linux')!==-1&&(d='linux'),c.href=`/${e}/${d}/`}})</script>