import{animate,createTimeline,onScroll,eases,text,stagger,}from"../modules/anime@4.1.2_esm.js";import detectPlatform from"../modules/detect-browser.mjs";import"../modules/dashjs@5.0.3.esm.min.js";const{outCirc,inCirc}=eases,releaseHeaderBackground=document.querySelector(".release-header-background"),scrollObserver=onScroll({target:".release-header",enter:"top 0%-=64px",leave:"top 100%",onUpdate:()=>{const e=scrollObserver.progress;releaseHeaderBackground.style.transform=`
			translateY(${e*releaseHeaderBackground.getBoundingClientRect().height}px)
			translateZ(-1px)
			scale(2)
		`,releaseHeaderBackground.style.filter=`blur(${inCirc(e)*5}px)`}}),releaseHeaderBackgroundTween=animate(releaseHeaderBackground,{autoplay:scrollObserver,ease:outCirc}),windowHeight=window.innerHeight,elements=[],releaseCardContainers=Array.from(document.querySelectorAll(".release-cards"));for(const e of releaseCardContainers){const t=Array.from(e.querySelectorAll(".release-card")),n=e.querySelector(".release-card:last-of-type");for(const s of t)elements.push({element:s,container:e,isLastOfType:s===n});e.classList.add("overflow-y-hidden")}const sectionContainers=Array.from(document.querySelectorAll(".section-title"));for(const e of sectionContainers)elements.push({element:e.querySelector("h3"),container:e,isLastOfType:!0}),e.classList.add("overflow-y-hidden");for(const e of elements){if(e.element.getBoundingClientRect().top<windowHeight){e.isLastOfType&&e.container.classList.remove("overflow-y-hidden");continue}const t=onScroll({trigger:e.element,enter:{target:"top",container:"bottom"}});animate(e.element,{y:{from:"+=50px"},opacity:{from:0},duration:500,autoplay:t,ease:outCirc,onComplete:()=>{e.isLastOfType&&e.container.classList.remove("overflow-y-hidden")}})}const platformData=detectPlatform(navigator.userAgent,navigator.userAgentData);let platformName="windows";switch(platformData.os){case"mac":case"iphone":case"ipad":platformName="macos";break;case"linux":platformName="linux";break;case"android":platformName="android";break;case"windows":default:break}const releasePlatformContainer=document.querySelector(".release-platform-container");if(releasePlatformContainer!=null){const e=releasePlatformContainer.querySelector(`.release-platform-${platformName}`);e!=null&&e.classList.add("active")}const downloadOther=document.querySelector(".card-download-other");downloadOther!=null&&(downloadOther.textContent="More downloads");const authors=Array.from(document.querySelectorAll("#special-thanks-release-authors .release-card-authors .release-card-author"));let max_prs=0;for(const e of authors)max_prs=Math.max(max_prs,Number(e.dataset.prs));const scales=new Array(5);for(let e=scales.length-1;e>=0;e--)e+1==scales.length?scales[e]=Math.floor(max_prs/2):scales[e]=Math.floor(scales[e+1]/2);for(const e of authors){const t=Number(e.dataset.prs);for(let n=0;n<scales.length;n++){if(t>=scales[n]){if(n+1==scales.length){e.classList.add(`size-${n+1}`);break}continue}if(n===0)break;e.classList.add(`size-${n+1}`);break}}const lazyVideoObserver=new IntersectionObserver((e,t)=>{for(const o of e){if(!o.isIntersecting)continue;const n=o.target,s=n.querySelector(":scope > source");if(s==null)continue;n.classList.remove("lazy"),s.src=s.dataset.src,delete s.dataset.src,n.load(),t.unobserve(n)}}),releaseCardVideoContainers=Array.from(document.querySelectorAll(".release-card-video-container"));for(const s of releaseCardVideoContainers){const t=s.querySelector(":scope > noscript");if(t==null)throw new Error("`.release-card-video-container > noscript` is null");const o=document.implementation.createHTMLDocument();o.write(t.innerHTML);const e=o.body.querySelector(":scope > .release-card-video");if(e==null)throw new Error("`.release-card-video-container > noscript > .release-card-video` is null");e.classList.add("lazy");const n=e.querySelector(":scope > source");if(n==null)throw new Error("`.release-card-video-container > noscript > .release-card-video > source` is null");n.dataset.src=n.src,n.src="",s.insertBefore(e,t),t.remove(),lazyVideoObserver.observe(e)}const linksElement=document.querySelector("#links"),scrollToTopElement=document.querySelector("#scroll-to-top");let scrollToTopTween=null,scrollState="";const showScrollToTop=()=>{if(scrollState==="show")return;scrollState="show",scrollToTopTween!=null&&scrollToTopTween.cancel(),scrollToTopElement.style.display="block",scrollToTopTween=animate(scrollToTopElement,{opacity:{to:1},duration:500})},hideScrollToTop=()=>{if(scrollState==="hide")return;scrollState="hide",scrollToTopTween!=null&&scrollToTopTween.cancel(),scrollToTopTween=animate(scrollToTopElement,{opacity:{to:0},duration:500,onComplete:()=>{scrollToTopElement.style.display="none"}})},scrollToTopObserver=new IntersectionObserver((e)=>{const n=e[0];if(n.isIntersecting)hideScrollToTop();else{const e=linksElement.getBoundingClientRect();e.y>window.innerHeight?hideScrollToTop():showScrollToTop()}});scrollToTopObserver.observe(linksElement);const releaseCardMediaElements=Array.from(document.querySelectorAll(".release-card-media"));for(const t of releaseCardMediaElements){const r=Array.from(t.querySelectorAll("video")),e=t.querySelector(".comparison-range");if(e==null)continue;const n=t.querySelector(".comparison-range-indicator");if(n==null)continue;const s=t.querySelector(".image-comparison-b, .video-comparison-b");if(s==null)continue;const o=()=>{s.style=`--mask-width: ${e.valueAsNumber}%;`},i=()=>{n.style=`left: calc(${e.valueAsNumber}% - (0.25em / 2))`},a=t=>{const n=e.getBoundingClientRect(),s=t.clientX-n.left,a=n.width;e.valueAsNumber=s/a*100;for(const e of r)e.paused&&e.play();o(),i()};e.addEventListener("pointerdown",a),e.addEventListener("pointermove",a),o(),i()}const anchors=Array.from(document.querySelector("main .release-container").querySelectorAll("a"));for(const e of anchors){if(e.classList.contains("download-button")&&e.dataset?.external!=="yes")continue;try{const t=new URL(e.href),n=t.protocol===window.location.protocol&&t.host===window.location.host&&t.port===window.location.port&&t.pathname===window.location.pathname&&t.hash.startsWith("#");n||(e.target="_blank")}catch(t){const e=new Error("Error while setting anchor target to blank.");e.cause=t,console.error(e)}}const videoUrl="/storage/releases/4.5/video/godot-lander-manifest.mpd",mediaPlayer=dashjs.MediaPlayer().create(),videoElement=document.getElementById("release-header-background-video");mediaPlayer.updateSettings({streaming:{abr:{rules:{throughputRule:{active:!0},bolaRule:{active:!1},insufficientBufferRule:{active:!0},switchHistoryRule:{active:!1},droppedFramesRule:{active:!1},abandonRequestsRule:{active:!1}}},buffer:{fastSwitchEnabled:!0}}}),mediaPlayer.initialize(videoElement,videoUrl,!0);const intlBlockquote=document.querySelector("#internationalization-live-preview .c-blockquote");if(intlBlockquote==null)throw new Error("`#internationalization-live-preview .c-blockquote` doesn't exist");const intlBlockquoteTextEntries=[{text:"Hello"},{text:"مرحبًا",rtl:!0},{text:"你好"},{text:"Hallo"},{text:"Bonjour"},{text:"Guten tag"},{text:"Halo"},{text:"Dia dhuit"},{text:"Ciao"},{text:"こんにちは"},{text:"안녕하세요"},{text:"سلام",rtl:!0},{text:"Cześć"},{text:"Olá"},{text:"Oi"},{text:"Привет"},{text:"Hola"},{text:"Hallå"},{text:"வணக்கம்"},{text:"Merhaba"},{text:"привіт"}];for(const t of intlBlockquoteTextEntries){const e=document.createElement("p");e.classList.add("entry"),e.textContent=t.text,e.style.direction=t?.rtl?"rtl":"ltr",intlBlockquote.append(e)}const intlBlockquoteEntries=Array.from(intlBlockquote.querySelectorAll("p.entry")).toSorted(()=>Math.random()>.5?1:-1),intlBlockquoteTimeline=createTimeline({loop:!0});for(const e of intlBlockquoteEntries){const{chars:t}=text.split(e,{chars:{wrap:"clip"}}),n=animate(t,{y:[{to:["100%","0%"]},{to:"-100%",delay:750,ease:"in(3)"}],duration:750,ease:"out(3)",delay:stagger(50,{from:"random"}),loop:!1});intlBlockquoteTimeline.sync(n)}intlBlockquoteTimeline.init()